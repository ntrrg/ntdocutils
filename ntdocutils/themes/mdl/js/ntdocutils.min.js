// NtDocutils https://blog.nt.web.ve/en/articles/ntdocutils/
// Copyright 2017 Miguel Angel Rivera Notararigo
// This file follows the Standart Style Guide (https://standardjs.com/)

'use strict';window.addEventListener('load',()=>{removeMediaPrint(),bFieldsToIcons(),setupBFields(),setupFilters(),setupArticleOptions(),setupExternalLinks()});const ICONS=new Map([['author','person'],['authors','people'],['organization','group_work'],['contact','contacts'],['address','place'],['version','history'],['status','show_chart'],['date','access_time'],['copyright','copyright'],['license','copyright'],['category','folder'],['tags','label']]);function addClass(a,b){for(const c of b.split(' '))hasClass(a,c)||(a.className+=' '+c)}function bFieldsToIcons(){const a=document.querySelectorAll('.docinfo dt');for(const b of a){const c=createElement('i',{class:'material-icons',title:b.textContent,textContent:ICONS.get(b.className)||'info'});updateElement(b,{innerHTML:''}),b.appendChild(c)}}function createElement(a,b){const c=document.createElement(a);return b&&updateElement(c,b),c}function fileToIcon(a){switch(a.match(/\.\w+$/g)[0]){case'.pdf':return'picture_as_pdf';case'.jpg':case'.jpeg':case'.png':case'.svg':return'image';default:return'insert_drive_file';}}function hasClass(a,b){return a.className.includes(b)}function removeElement(a){a.parentNode.removeChild(a)}function removeClass(a,b){for(const c of b.split(' '))hasClass(a,c)&&(a.className=a.className.replace(new RegExp(c,'g'),'').replace(/ {2,}/g,' ').trim())}function removeMediaPrint(){const a=document.styleSheets;for(const b of a)if(!b.href){const c=b.cssRules?b.cssRules:b.rules;let d=0;for(const e of c)e.cssText.includes('@media print')&&b.deleteRule(d),++d}}function selectFilter(a){let b=document.querySelectorAll('.fl.is-visible');for(const c of b)removeClass(c,'is-visible');b=document.querySelectorAll(`.fl-${a}`);for(const c of b)addClass(c,'is-visible')}function setupArticleOptions(){const a=document.querySelector('#options'),b=a.querySelector('#options-button');updateElement(b,{events:{click:()=>{const h=a.querySelectorAll('button:not(#options-button)');let i;if(!hasClass(b,'open')){let j=1;for(const k of h)updateElement(k,{style:{bottom:115*j++ +'%'}});i='close'}else{for(const j of h)updateElement(j,{style:{bottom:'0px'}});i='more_vert'}toggleClass(b,'open'),updateElement(b.querySelector('i.material-icons'),{textContent:i})}}});const c=a.querySelector('#invert-button');updateElement(c,{events:{click:()=>{const h=document.querySelector('.mdl-layout');let i;hasClass(h,'dark-theme')?(i='invert_colors',snackbar('Light theme is enabled')):(i='invert_colors_off',snackbar('Dark theme is enabled')),toggleClass(h,'dark-theme'),updateElement(c.querySelector('i.material-icons'),{textContent:i})}}});const d=a.querySelector('#print-button');updateElement(d,{events:{click:()=>window.print()}});const e=a.querySelector('#attachments-menu');window.ATTACHMENTS=window.ATTACHMENTS||[];for(const h of window.ATTACHMENTS)e.appendChild(createElement('a',{href:h.url,download:h.name||'',children:[createElement('li',{class:'mdl-menu__item',textContent:h.name||h.url,children:[createElement('i',{class:'material-icons',textContent:h.icon||fileToIcon(h.url)})]})]}));0===window.ATTACHMENTS.length&&removeElement(a.querySelector('#attachments-button'));const f=a.querySelector('#lang-menu');window.LANGS=window.LANGS||[];for(const h of window.LANGS)f.appendChild(createElement('a',{href:h.url,children:[createElement('li',{class:'mdl-menu__item',textContent:h.name})]}));0===window.LANGS.length&&removeElement(a.querySelector('#lang-button'));const g=a.querySelector('#versions-menu');window.VERSIONS=window.VERSIONS||[];for(const h of window.VERSIONS)g.appendChild(createElement('a',{href:h.url,children:[createElement('li',{class:'mdl-menu__item',textContent:h.name})]}));0===window.VERSIONS.length&&removeElement(a.querySelector('#versions-button'))}function setupBFields(){const a=document.querySelector('.docinfo dd.category p');if(a){const c=a.textContent;updateElement(a,{textContent:''}),updateElement(a,{children:[createElement('a',{href:'#',textContent:c})]})}const b=document.querySelector('.docinfo dd.tags p');if(b){const c=b.textContent.replace(/ /g,'').split(';');updateElement(b,{textContent:''});for(const d of c.slice(0,c.length-1))updateElement(b,{children:[createElement('a',{class:'tag',href:'#',textContent:d+';'})]})}}function setupExternalLinks(){const a=document.querySelectorAll('a:not([href^="#"])');for(const b of a)b.href&&updateElement(b,{target:'_blank'})}function setupFilters(){const a=document.querySelectorAll('.fl'),b=[],c=/fl-[\w-]+/g;for(const d of a){const e=d.className.match(c);for(let f of e)(f=f.slice(3),!b.includes(f))&&b.push(f)}selectFilter(b[0]),b.sort();for(const d of b){const e=createElement('button',{class:'mdl-button mdl-js-button mdl-button--raised mdl-button--accent mdl-js-ripple-effect','data-filter':d,textContent:d.toUpperCase(),events:{click:()=>{const f=e.dataset.filter;selectFilter(f),snackbar(`Using filter: ${f.toUpperCase()}`)}}});document.querySelector('#filter_selection').appendChild(e),window.componentHandler.upgradeElement(e)}}function snackbar(a){const b=document.querySelector('#snackbar');b.MaterialSnackbar.showSnackbar({message:a})}function toggleClass(a,b){b=b.split(' ');for(const c of b)hasClass(a,c)?removeClass(a,c):addClass(a,c)}function updateElement(a,b){for(const[c,d]of Object.entries(b))switch(c){case'innerHTML':case'textContent':a[c]=d;break;case'style':for(const[e,f]of Object.entries(d))a[c][e]=f;break;case'children':for(const e of d)a.appendChild(e);break;case'events':for(const[e,f]of Object.entries(d))if(f instanceof Array)for(const g of f)a.addEventListener(e,g);else a.addEventListener(e,f);break;default:a.setAttribute(c,d);}return a}
